name: Ubuntu Tailscale RDP

on:
  workflow_dispatch: # Allows you to manually trigger the workflow

jobs:
  debug-rdp:
    runs-on: ubuntu-latest
    steps:
      # 1. Checkout Code (Optional, but good practice)
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. Install Desktop Environment (XFCE) and XRDP
      - name: Install Desktop & XRDP
        run: |
          sudo apt-get update
          sudo apt-get install -y xfce4 xfce4-goodies xrdp
          sudo apt-get install -y firefox # Optional: Install a browser
          
          # Configure XRDP to use XFCE
          echo xfce4-session > ~/.xsession
          sudo service xrdp start

      # 3. Set Password for the 'runner' user
      # CHANGE "mypassword123" to something secure!
      - name: Set User Password
        run: |
          echo "runner:mypassword123" | sudo chpasswd

      # 4. Connect to Tailscale
      - name: Connect to Tailscale
        uses: tailscale/github-action@v2
        with:
          authkey: ${{ secrets.TAILSCALE_AUTHKEY }}
          version: latest

      # 5. Display IP and Keep Alive
      - name: Show IP and Keep Alive
        run: |
          echo "‚úÖ Tailscale is up!"
          echo "üîå Connect via RDP to this IP:"
          tailscale ip -4
          
          echo "‚è≥ Keeping session alive for 6 hours..."
          sleep 21600 # Keeps the runner active for 6 hours
          
